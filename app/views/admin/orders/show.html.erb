<h3>注文履歴詳細</h3>

<table>
  <tr>
    <td>購入者</td>
    <th><%= @order.customer.last_name %><%= @order.customer.first_name %></th>
  </tr>
  <tr>
    <td>注文日</td>
    <th><%= @order.created_at.strftime('%Y/%m/%d') %></th>
  </tr>
  <tr>
    <td>配送先</td>
    <th>
      〒<%= @order.delivery_postal_code %> <%= @order.delivery_address %><br />
      <%= @order.delivery_name %>
    </th>
  </tr>
  <tr>
    <td>支払方法</td>
    <th><%= @order.payment_method %></th>
  </tr>
  <tr>
    <td>注文ステータス</td>
    <th>
    <%= form_with model:@order, url: admin_order_path, local:true do |f| %>
      <%= f.select :status, Order.statuses.keys.map{|k| [I18n.t("enums.order.status.#{k}"), k]}, {} %>
      <!--<#%= f.select :status, options_for_select(Order.statuses.keys, selected: Order.statuses[@order.status]) %>-->
      <%= f.submit '更新' %>
    <% end %>
    </th>
  </tr>
</table>

<table>
  <thead>
    <tr>
      <th>商品名</th>
      <th>単価（税込）</th>
      <th>数量</th>
      <th>小計</th>
      <th>製作ステータス</th>
    </tr>
  </thead>
  <tbody>
    <% @order.order_products.each do |order_product| %>
      <tr>
        <td><%= order_product.item.name %></td>
        <td><%= order_product.tax_included.to_s(:delimited) %>円</td>
        <td><%= order_product.amount %>個</td>
        <td><%= order_product.total_price.to_s(:delimited) %>円</td>
        <td>
          <%= form_with model:order_product, url:admin_order_product_path(order_product), method: :patch, local:true do |f| %>
            <%= f.select :making_status, OrderProduct.making_statuses.keys.map{|k| [I18n.t("enums.order_product.making_status.#{k}"), k]}, {} %>
            <!--<#%= f.select :making_status, options_for_select(OrderProduct.making_statuses.keys, selected: OrderProduct.making_statuses[order_product.making_status]) %>-->
            <%= f.hidden_field :order_id, value: @order.id %>
            <%= f.submit '更新' %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<table>
  <tr>
    <td>商品合計</td>
    <th><%= @order.total_price.to_s(:delimited) %>円</th>
  </tr>
  <tr>
    <td>送料</td>
    <th><%= @order.delivery_cost.to_s(:delimited) %>円</th>
  </tr>
  <tr>
    <td>請求金額合計</td>
    <th><%= (@order.total_price + @order.delivery_cost).to_s(:delimited)  %>円</th>
  </tr>
</table>